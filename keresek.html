<!DOCTYPE html>
<html lang="hu">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kérések</title>
    <style>
        /* Alap stílusok */
        body {
            font-family: Arial, sans-serif;
            background-color: #1f1f1f;
            color: #ffffff;
            margin: 0;
            padding: 0;
        }

        header, nav, section, footer {
            text-align: center;
        }

        header {
            background-color: #333;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        nav {
            background-color: #222;
            padding: 10px;
        }

        nav a {
            color: #ffffff;
            text-decoration: none;
            margin: 0 15px;
        }

        section {
            padding: 20px;
            margin-right: 40px;
        }

        .comment-form {
            margin-top: 20px;
            text-align: center;
        }

        .comment-input {
            width: 60%;
            padding: 8px;
            margin-right: 10px;
        }

        .comment-button {
            padding: 8px;
            cursor: pointer;
        }

        .comments {
            text-align: left;
            margin-top: 20px;
        }

        /* Kommentek stílusa */
        /* Kommentek stílusa */
.comment {
    background-color: #333;
    color: #ffffff;
    padding: 10px;
    margin: 10px auto; /* Margin hozzáadva, és az 'auto' érték középre igazítja */
    border-radius: 5px;
    max-width: 80%;
    word-wrap: break-word;
}


        footer {
            background-color: #333;
            padding: 10px;
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <header>
        <img src="Logo.png" alt="UCore Free Logo" style="width: 10%; max-width: 50px; display: block; margin-right: 10px;">
        <h1>Kérések</h1>
    </header>

    <nav>
        <a href="index.html">Főoldal</a>
        <a href="keresek.html">Kérések</a>
        <a href="Sign.html">Bejelentkezés</a>
        <!-- Adjon hozzá linkeket más oldalakra, amint szükséges -->
    </nav>

    <section>
        <h2>Kérések oldal tartalma</h2>
        <!-- Az oldal tartalma -->

        <!-- Komment űrlap -->
        <div class="comment-form">
            <input type="text" class="comment-input" placeholder="Add hozzászólásodat...">
            <button class="comment-button" onclick="addComment()">Hozzászólás</button>
        </div>

        <!-- Kommentek megjelenítése -->
        <div class="comments" id="commentSection">
            <!-- Itt jelennek meg a kommentek -->
        </div>
    </section>

    <footer>
        &copy; 2024 UCore Free. Minden jog fenntartva.
    </footer>

    <!-- Firebase inicializálása és scriptek -->
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
    <!-- Firebase Authentication inicializálása -->
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-firestore.js"></script>

    <script>
        // Firebase konfiguráció
const firebaseConfig = {
    apiKey: "AIzaSyDNWHkdfwtPJb1KLPKkLUTLh0mHMukRadY",
    authDomain: "films-bcc81.firebaseapp.com",
    databaseURL: "https://films-bcc81-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "films-bcc81",
    storageBucket: "films-bcc81.appspot.com",
    messagingSenderId: "202459241023",
    appId: "1:202459241023:web:a59e0203460ccb04f3768a",
    measurementId: "G-N9LYG1Z83B"
};

// Firebase inicializálása
firebase.initializeApp(firebaseConfig);

// Firebase Authentication inicializálása
const auth = firebase.auth();
let currentUser;

// Firebase adatbázis referenciája
const database = firebase.database();

// Hozzászólás hozzáadása
function addComment() {
    const commentInput = document.querySelector('.comment-input');
    const commentSection = document.getElementById('commentSection');

    if (commentInput.value.trim() !== '') {
        // Ellenőrizze, hogy a felhasználó be van-e jelentkezve
        if (currentUser) {
            // Ellenőrizze, hogy a felhasználó már hozzászólt-e
            const userCommentsRef = database.ref(`user-comments/${currentUser.uid}`);
            userCommentsRef.once('value', function (snapshot) {
                if (!snapshot.val()) {
                    // A felhasználó még nem hozzászólt, tehát hozzáadhatja a kommentet
                    const commentRef = database.ref('comments').push();
                    commentRef.set({
                        text: commentInput.value,
                        timestamp: firebase.database.ServerValue.TIMESTAMP,
                        userId: currentUser.uid
                    });

                    // Komment szöveges tartalmának mentése a Firebase Storage-ba
                    const storageRef = firebase.storage().ref();
                    const commentFileRef = storageRef.child('comments/' + commentRef.key + '.txt');
                    commentFileRef.putString(commentInput.value);

                    // Komment megjelenítése a felületen
                    const comment = document.createElement('div');
                    comment.classList.add('comment');
                    comment.innerHTML = `<p>${commentInput.value}</p><small>${formatCommentTime(commentRef.key)}</small>`;
                    commentSection.appendChild(comment);

                    // Hozzáadja a felhasználóhoz tartozó kommentet
                    userCommentsRef.set(true);

                    commentInput.value = '';
                } else {
                    alert('Már hozzászóltál!');
                }
            });
        } else {
            alert('Először jelentkezz be!');
        }
    }
}

// Firebase Authentication figyelő, hogy megállapítsuk, ha egy felhasználó be van jelentkezve
auth.onAuthStateChanged(function (user) {
    currentUser = user;
});

// Oldal betöltésekor a kommentek megjelenítése
document.addEventListener('DOMContentLoaded', function () {
    loadComments();
});

        // Kommentek betöltése és megjelenítése
        function loadComments() {
            const commentSection = document.getElementById('commentSection');

            // Kommentek lekérése a Firebase adatbázisból a child_added eseménnyel
            const commentsRef = database.ref('comments');
            commentsRef.on('child_added', function (snapshot) {
                const commentText = snapshot.val().text;
                const commentTimestamp = snapshot.val().timestamp;

                // Komment időbélyeg formázása
                const commentTime = formatCommentTime(commentTimestamp);

                // Komment div létrehozása és formázása
                const commentDiv = document.createElement('div');
                commentDiv.classList.add('comment');
                commentDiv.innerHTML = `<p>${commentText}</p><small>${commentTime}</small>`;

                // Komment megjelenítése a felületen
                commentSection.appendChild(commentDiv);
            });

            // Kommentek lekérése a Firebase adatbázisból a value eseménnyel
            commentsRef.once('value', function (snapshot) {
                commentSection.innerHTML = ''; // Törlés, hogy ne ismételjük meg a már megjelenített kommenteket
                snapshot.forEach(function (childSnapshot) {
                    const commentText = childSnapshot.val().text;
                    const commentTimestamp = childSnapshot.val().timestamp;

                    // Komment időbélyeg formázása
                    const commentTime = formatCommentTime(commentTimestamp);

                    // Komment div létrehozása és formázása
                    const commentDiv = document.createElement('div');
                    commentDiv.classList.add('comment');
                    commentDiv.innerHTML = `<p>${commentText}</p><small>${commentTime}</small>`;

                    // Komment megjelenítése a felületen
                    commentSection.appendChild(commentDiv);
                });
            });
        }

        // Komment időbélyeg formázása
        function formatCommentTime(timestamp) {
            const currentDate = new Date();
            const commentDate = new Date(timestamp);
            const timeDifference = currentDate - commentDate;

            if (timeDifference < 60000) {
                // Kevesebb mint 1 perc
                return 'Épp most';
            } else if (timeDifference < 3600000) {
                // Kevesebb mint 1 óra
                const minutes = Math.floor(timeDifference / 60000);
                return `${minutes} perce`;
            } else if (commentDate.toDateString() === currentDate.toDateString()) {
                // Ugyanaz a nap
                const hours = commentDate.getHours();
                const minutes = commentDate.getMinutes();
                return `Ma ${hours}:${minutes}`;
            } else {
                // Másnap vagy régebbi
                return commentDate.toLocaleString();
            }
        }

        // Oldal betöltésekor a kommentek megjelenítése
        document.addEventListener('DOMContentLoaded', function () {
            loadComments();
        });
    </script>
</body>

</html>
